
@{
    ViewData["Title"] = "Cat치logo";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cat치logo - Panader칤a</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS EXISTENTE -->
    <link rel="stylesheet" href="/css/customercat.css">    
</head>
<body class="min-h-screen">

    <!-- HEADER -->
    <header class="header">
        <div class="header-content container">
            <div class="header-left">
                <div class="logo">
                    <img src="/img/logo.png" alt="Panader칤a">
                </div>
                <div>
                    <h1 class="header-title">Panader칤a Artesanal</h1>
                    <p class="header-subtitle">Cat치logo de productos</p>
                </div>
            </div>

            <div class="header-right flex gap-3 items-center">

                    @if (ViewBag.NombreUsuario != null)
                    {
                        <span class="user-welcome">
                            游녦 Bienvenido, <strong>@ViewBag.NombreUsuario</strong>
                        </span>
                    }


    <!-- BOT칍N CARRITO -->
                <button class="btn btn-outline relative" onclick="irAlCarrito()">
                    游 Carrito
                </button>

                <!-- CERRAR SESI칍N -->
                <button class="btn btn-ghost" onclick="irALogin()">Cerrar sesi칩n</button>
            </div>

        </div>
    </header>

    <!-- MAIN -->
    <main class="main-content container">

        <!-- T칈TULO -->
        <div class="mb-2">
            <h2 class="text-2xl">Cat치logo de Productos</h2>
            <p class="text-muted mt-1">Descubre nuestros productos artesanales</p>
        </div>

        <!-- GRID PRODUCTOS -->
        <div id="catalogo" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6"></div>

    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            춸 2025 Panader칤a Artesanal 췅 Todos los derechos reservados
        </div>
    </footer>

    <script>
        const API_URL = "http://localhost:5026/api/Catalogo/publico";
        const LOGIN_URL = '@Url.Action("Index", "LoginMvc")';
        const CARRITO_URL = '@Url.Action("Index", "Carrito")';

function irAlCarrito() {
    window.location.href = CARRITO_URL;
}


        async function cargarCatalogo() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Error HTTP " + response.status);

                const productos = await response.json();
                const contenedor = document.getElementById("catalogo");
                contenedor.innerHTML = "";

                if (productos.length === 0) {
                    contenedor.innerHTML = `
                        <div class="empty-state card">
                            <p class="text-muted">No hay productos disponibles</p>
                        </div>`;
                    return;
                }

                productos.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "card overflow-hidden transition-all";

                    card.innerHTML = `
                        <div class="aspect-video overflow-hidden">
                            <img 
                                src="${p.imagen || 'https://via.placeholder.com/400x250?text=Sin+Imagen'}"
                                class="w-full h-full object-cover product-image"
                                alt="${p.nombreProducto}">
                        </div>

                        <div class="card-content space-y-3">
                            <div class="flex justify-between items-center">
                                <h4 class="truncate">${p.nombreProducto}</h4>
                                <span class="badge badge-primary">${p.categoria.nombreCategoria}</span> 
                            </div>

                            <p class="text-sm text-muted">
                                ${p.descripcion || 'Producto artesanal de alta calidad'}
                            </p>

                            <div class="flex justify-between items-center">
                                <strong class="text-primary">$ ${p.precio.toFixed(2)}</strong>

                                <button 
                                    class="btn btn-primary btn-sm"
                                    onclick="agregarAlCarrito(${p.idProducto})">
                                    Agregar al carrito
                                </button>

                            </div>
                        </div>
                    `;

                    contenedor.appendChild(card);
                });

            } catch (error) {
                console.error(error);
                document.getElementById("catalogo").innerHTML = `
                    <div class="empty-state card">
                        <p class="text-muted">Error cargando productos</p>
                    </div>`;
            }
        }

        function irALogin() {
            window.location.href = LOGIN_URL;
        }
        async function agregarAlCarrito(idProducto) {
    try {
        const response = await fetch('/Carrito/Agregar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `idProducto=${idProducto}&cantidad=1`
        });

        if (!response.ok) throw new Error("Error al agregar");

        alert("Producto agregado al carrito 游");

    } catch (error) {
        console.error(error);
        alert("Error al agregar al carrito");
    }
}


        document.addEventListener("DOMContentLoaded", cargarCatalogo);
    </script>

</body>
</html>
